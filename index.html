<script>
    // üéØ –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –ö–ê–†–£–°–ï–õ–¨ + –ê–£–î–ò–û/–í–ò–î–ï–û
    (function() {
        'use strict';
        
        // üîç –≠–õ–ï–ú–ï–ù–¢–´
        const track = document.getElementById('carouselTrack');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const dotsContainer = document.getElementById('carouselDots');
        const bgVideo = document.getElementById('bgVideo');
        const bgAudio = document.getElementById('bgAudio');
        
        let currentSlide = 0;
        let totalSlides = 3;
        let dots = [];
        let autoplayInterval;
        let isAutoplay = false;
        let touchStartX = 0;
        let touchEndX = 0;
        
        // üìè –ê–î–ê–ü–¢–ò–í–ù–´–ô –†–ê–°–ß–ï–¢ –†–ê–ó–ú–ï–†–û–í
        function getSlideWidth() {
            const carousel = document.querySelector('.characters-carousel');
            return carousel.offsetWidth;
        }
        
        // üîÑ –û–ë–ù–û–í–ò–¢–¨ –ö–ê–†–£–°–ï–õ–¨
        function updateCarousel() {
            const slideWidth = getSlideWidth();
            const translateX = -currentSlide * slideWidth;
            track.style.transform = `translateX(${translateX}px)`;
            
            // ‚úÖ –ê–ö–¢–ò–í–ù–ê–Ø –¢–û–ß–ö–ê
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
            
            // üîí –ë–õ–û–ö–ò–†–û–í–ö–ê –ö–ù–û–ü–û–ö
            prevBtn.style.opacity = currentSlide === 0 ? '0.5' : '1';
            nextBtn.style.opacity = currentSlide === totalSlides - 1 ? '0.5' : '1';
            prevBtn.style.cursor = currentSlide === 0 ? 'not-allowed' : 'pointer';
            nextBtn.style.cursor = currentSlide === totalSlides - 1 ? 'not-allowed' : 'pointer';
        }
        
        // ‚û°Ô∏è –°–õ–ï–î–£–Æ–©–ò–ô –°–õ–ê–ô–î
        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                currentSlide++;
            } else {
                currentSlide = 0; // üîÅ –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
            }
            updateCarousel();
        }
        
        // ‚¨ÖÔ∏è –ü–†–ï–î–´–î–£–©–ò–ô –°–õ–ê–ô–î
        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
            } else {
                currentSlide = totalSlides - 1; // üîÅ –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
            }
            updateCarousel();
        }
        
        // üéØ –ü–ï–†–ï–•–û–î –ö –°–õ–ê–ô–î–£
        function goToSlide(slideIndex) {
            currentSlide = slideIndex;
            updateCarousel();
        }
        
        // üñ±Ô∏è –°–û–ó–î–ê–ù–ò–ï –¢–û–ß–ï–ö
        function createDots() {
            dotsContainer.innerHTML = '';
            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('div');
                dot.className = 'dot';
                if (i === 0) dot.classList.add('active');
                dot.addEventListener('click', () => goToSlide(i));
                dotsContainer.appendChild(dot);
                dots.push(dot);
            }
        }
        
        // üì± –°–í–ê–ô–ü –î–õ–Ø –ú–û–ë–ê–ô–õ
        function addSwipeSupport() {
            track.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            track.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
        }
        
        // üëÜ –û–ë–†–ê–ë–û–¢–ö–ê –°–í–ê–ô–ü–ê
        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    nextSlide(); // –°–≤–∞–π–ø –≤–ª–µ–≤–æ
                } else {
                    prevSlide(); // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ
                }
            }
        }
        
        // üéµ –ê–í–¢–û–ó–ê–ü–£–°–ö
        function startAutoplay() {
            if (isAutoplay) return;
            isAutoplay = true;
            autoplayInterval = setInterval(nextSlide, 4000);
        }
        
        function stopAutoplay() {
            isAutoplay = false;
            clearInterval(autoplayInterval);
        }
        
        // üé¨ –í–ò–î–ï–û + –ê–£–î–ò–û (–º–æ–±–∏–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
        function initMedia() {
            const playMedia = () => {
                bgVideo.play().catch(() => {});
                bgAudio.play().catch(() => {});
                document.removeEventListener('click', playMedia, { once: true });
                document.removeEventListener('touchstart', playMedia, { once: true });
            };
            
            // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–æ –ø–µ—Ä–≤–æ–º—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—é
            document.addEventListener('click', playMedia, { once: true });
            document.addEventListener('touchstart', playMedia, { once: true });
            
            // üîá –ü–ê–£–ó–ê –ü–†–ò –°–ö–†–´–¢–û–ú –í–ò–î–ï–û
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    bgVideo.pause();
                    bgAudio.pause();
                } else {
                    bgVideo.play().catch(() => {});
                }
            });
        }
        
        // üìê –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –ü–†–ò –ò–ó–ú–ï–ù–ï–ù–ò–ò –†–ê–ó–ú–ï–†–ê
        function initResizeHandler() {
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    updateCarousel();
                }, 250);
            });
        }
        
        // üöÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        function init() {
            createDots();
            updateCarousel();
            
            // üéÆ –°–û–ë–´–¢–ò–Ø
            if (prevBtn) prevBtn.addEventListener('click', prevSlide);
            if (nextBtn) nextBtn.addEventListener('click', nextSlide);
            
            // üì± –ú–û–ë–ê–ô–õ
            addSwipeSupport();
            
            // üé¨ –ú–ï–î–ò–ê
            initMedia();
            
            // üìê –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨
            initResizeHandler();
            
            // üéµ –ê–í–¢–û–ó–ê–ü–£–°–ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            // startAutoplay();
        }
        
        // ‚è≥ –ó–ê–ü–£–°–ö –ü–û–°–õ–ï –ó–ê–ì–†–£–ó–ö–ò DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
    })();
</script>
